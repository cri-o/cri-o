---

- name: fetch Golang
  unarchive:
    remote_src: yes
    src: https://storage.googleapis.com/golang/go1.8.4.linux-amd64.tar.gz
    dest: /usr/local

- name: link go toolchain
  file:
    src: "/usr/local/go/bin/{{ item }}"
    dest: "/usr/bin/{{ item }}"
    state: link
  with_items:
    - go
    - gofmt
    - godoc

- name: set up directories
  file:
    path: "{{ go_path }}/src/github.com/{{ item }}"
    state: directory
  with_items:
    - "containernetworking"
    - "kubernetes-incubator"
    - "k8s.io"
    - "sstephenson"
    - "opencontainers"

- name: install Go tools and dependencies
  shell: /usr/bin/go get -u "github.com/{{ item }}"
  with_items:
    - tools/godep
    - onsi/ginkgo/ginkgo
    - onsi/gomega
    - cloudflare/cfssl/cmd/...
    - jteeuwen/go-bindata/go-bindata
    - vbatts/git-validation
    - cpuguy83/go-md2man
