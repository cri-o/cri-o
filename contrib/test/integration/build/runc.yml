---
- name: clone runc source repo
  git:
    repo: "https://github.com/opencontainers/runc.git"
    dest: "{{ ansible_env.GOPATH }}/src/github.com/opencontainers/runc"
    version: "HEAD"

- name: build runc
  command: "/usr/local/bin/podman run --privileged --rm --net=host --env HOME=/root --env BUILDTAGS='seccomp selinux' -v {{ ansible_env.GOPATH }}/src/github.com/opencontainers/runc:/src -w /src quay.io/haircommander/go-1.13-build-runc make"
  args:
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/opencontainers/runc"

- name: install runc
  make:
    target: "install"
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/opencontainers/runc"

- name: link runc
  file:
    src: /usr/local/sbin/runc
    dest: /usr/bin/runc
    state: link
    force: yes
