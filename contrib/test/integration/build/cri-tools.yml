---

- name: clone cri-tools source repo
  git:
    repo: "https://github.com/kubernetes-sigs/cri-tools.git"
    dest: "{{ ansible_env.GOPATH }}/src/github.com/kubernetes-sigs/cri-tools"
    version: "{{ cri_tools_git_version }}"
    force: "{{ force_clone | default(False) | bool}}"

- name: build cri-tools
  make:
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/kubernetes-sigs/cri-tools"

- name: copy crictl and critest to /usr/bin
  copy:
    src: "{{ ansible_env.GOPATH }}/src/github.com/kubernetes-sigs/cri-tools/build/bin/{{ item }}"
    dest: "/usr/bin/{{ item }}"
    mode: "preserve"
  with_items:
    - "critest"
    - "crictl"
