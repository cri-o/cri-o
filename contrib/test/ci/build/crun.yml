---

- name: clone crun source repo
  git:
    repo: "https://github.com/containers/crun.git"
    dest: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun"
    force: "{{ force_clone | default(False) | bool}}"
    version: "HEAD"

- name: Install crun dependencies
  raw: >
    yum install -y \
      python \
      git \
      gcc \
      automake \
      autoconf \
      libcap-devel \
      systemd-devel \
      yajl-devel \
      libseccomp-devel \
      libselinux-devel \
      go-md2man \
      glibc-static \
      python3-libmount \
      libtool \
      pkgconf-pkg-config \
      gperf \
      libtool

- name: Run autogen.sh
  command: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun/autogen.sh"
  args:
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun"

- name: Run configure
  command: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun/configure"
  args:
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun"

- name: run crun clean
  make:
    target: clean
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun"

- name: build crun
  make:
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun"

- name: install crun
  make:
    target: "install"
    chdir: "{{ ansible_env.GOPATH }}/src/github.com/containers/crun"
